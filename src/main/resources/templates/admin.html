<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
</head>
<body>
<br>
<div class="container">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>USER ID</th>
                <th>FULL NAME</th>
                <th>EMAIL</th>
                <th>IS BLOCKED</th>
                <th>ACTION</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    <br><br><br>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>ACCOMODATION ID</th>
                <th>CITY</th>
                <th>LOCATION</th>
                <th>NAME</th>
                <th>USER ID</th>
                <th>STATUS</th>
                <th>DETAILS</th>
            </tr>
        </thead>
        <tbody id="accomodationTableBody">

        </tbody>
    </table>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetchUsers();
        function fetchUsers() {
            fetch('/users')
                .then(response => response.json())
                .then(users => {
                    const tbody = document.querySelector('table tbody');
                    tbody.innerHTML = ''; // Очищаем текущие строки таблицы
                    users.forEach(user => {
                        const row = `<tr>
                                <td>${user.id}</td>
                                <td>${user.fullName}</td>
                                <td>${user.email}</td>
                                <td>${user.blocked ? 'Yes' : 'No'}</td>
                                <td>
                                    <button onclick="deleteUser(${user.id})" class="btn btn-danger">Delete</button>
                                    <button onclick="blockUser(${user.id})" class="btn btn-warning">Block</button>
                                </td>
                             </tr>`;
                        tbody.innerHTML += row;
                    });
                });
        }

        // Делаем функцию deleteUser глобально доступной, чтобы вызывать из HTML
        window.deleteUser = function(id) {
            fetch('/users/' + id, {
                method: 'DELETE'
            })
                .then(() => fetchUsers()) // Перезагрузка списка пользователей после удаления
                .catch(error => console.error('Error:', error));
        };

        window.blockUser = function(id) {
            fetch('/users/' + id + '/block', {
                method: 'PATCH',
                // Убедитесь, что добавили необходимые заголовки, если ваш API их требует
            })
                .then(response => {
                    if(response.ok) {
                        fetchUsers(); // Перезагрузка списка пользователей после блокировки
                    } else {
                        alert('Failed to block user');
                    }
                })
                .catch(error => console.error('Error:', error));
        };
    });
</script>

</body>
</html>